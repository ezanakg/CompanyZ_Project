@startuml
skinparam packageStyle rectangle
skinparam defaultTextAlignment left
left to right direction

' =====================================================
'                      MODELS
' =====================================================
package "Models" {
    class UserCredentials {
        -username : String
        -role : String
        +isAdmin() : boolean
        +isEmployee() : boolean
    }

    class Employee {
        -empId : int
        -name : String
    }

    class EmployeeSearchResult {
        -empId : int
        -name : String
        -salary : double
    }

    class PayrollRecord {
        -empId : int
        -salary : double
        -payDate : LocalDate
    }

    class Report {
        -category : String
        -totalPayment : double
    }
}

' =====================================================
'                  DATABASE LAYER
' =====================================================
package "BottomLayer" {
    left to right direction

    package "Repositories (interfaces)" {
        interface IAuthRepository {
            +validateLogin(String,String) : UserCredentials
        }
        interface IEmployeeRepository {
            +searchEmployee(String) : List<EmployeeSearchResult>
            +searchBySsn(String) : List<EmployeeSearchResult>
            +getEmployeeById(int) : Employee
        }
        interface IPayrollRepository {
            +getPayHistory(int) : List<PayrollRecord>
            +updateSalaryRange(double,double,double) : int
            +getTotalPayByJobTitle() : List<Report>
            +getTotalPayByDivision() : List<Report>
        }
    }

    package "Repositories (impl)" {
        class AuthRepository {
            -SEARCH_QUERY : String
            -GET_BY_ID_QUERY : String
        }
        class EmployeeRepository {
            -SEARCH_QUERY : String
            -SEARCH_BY_SSN_QUERY : String
            -GET_BY_ID_QUERY : String
        }
        class PayrollRepository {
            -GET_HISTORY_QUERY : String
            -UPDATE_SALARY_QUERY : String
        }

        class MockAuthRepository {
            demo credentials: admin/admin123, employee/emp123
        }
        class MockEmployeeRepository {
            mock employee data with SSNs
        }
        class MockPayrollRepository {
            simulated payroll data
        }
    }

    package "Database" {
        class DBConnection {
            +getConnection() : Connection
            +testConnection() : boolean
        }
    }
}

' ================= Relationships (Bottom layer) ==================

AuthRepository --|> IAuthRepository : implements
EmployeeRepository --|> IEmployeeRepository : implements
PayrollRepository --|> IPayrollRepository : implements

MockAuthRepository --|> IAuthRepository : implements
MockEmployeeRepository --|> IEmployeeRepository : implements
MockPayrollRepository --|> IPayrollRepository : implements

AuthRepository ..> UserCredentials : uses
EmployeeRepository ..> Employee : uses
EmployeeRepository ..> EmployeeSearchResult : uses
PayrollRepository ..> PayrollRecord : uses
PayrollRepository ..> Report : uses

AuthRepository --> DBConnection : uses
EmployeeRepository --> DBConnection : uses
PayrollRepository --> DBConnection : uses

' =====================================================
'                     SERVICES
' =====================================================
package "Services" {
    class AuthService {
        -authRepository : IAuthRepository
        +login(String,String) : UserCredentials
        +isAdmin(UserCredentials) : boolean
        +isEmployee(UserCredentials) : boolean
    }

    class EmployeeService {
        -employeeRepository : IEmployeeRepository
        +searchEmployees(String) : List
        +formatSearchResults(List) : String
    }

    class PayrollService {
        -payrollRepository : IPayrollRepository
        +getPayHistory(int) : List
        +applySalaryRaise(double,double,double) : int
        +getJobTitleReport() : List
        +getDivisionReport() : List
        +formatPayHistory(List) : String
        +formatReport(List,String) : String
    }
}

' ================= Relationships (Services) ==================
AuthService --> IAuthRepository : uses
EmployeeService --> IEmployeeRepository : uses
PayrollService --> IPayrollRepository : uses

EmployeeService ..> EmployeeSearchResult
PayrollService ..> PayrollRecord
PayrollService ..> Report

' =====================================================
'                       USERS
' =====================================================
package "Users" {
    class User {
        -username : String
        -role : String
        +displayDashboard()
        +logout()
    }

    class AdminUser {
        -employeeService : EmployeeService
        -payrollService : PayrollService
        +searchEmployees(String) : String
        +applySalaryRaise(double,double,double) : int
        +getJobTitleReport() : String
        +getDivisionReport() : String
    }

    class EmployeeUser {
        -payrollService : PayrollService
        +viewPayHistory() : String
        +getSalaryInfo() : String
    }
}

AdminUser ..> EmployeeService
AdminUser ..> PayrollService
EmployeeUser ..> PayrollService

User <|-- AdminUser
User <|-- EmployeeUser

' =====================================================
'                         UI
' =====================================================
package "UI" {
    class AppLauncher {
        +main(String[] args)
    }

    class MainApp {
        -stage : Stage
        -authService : AuthService
        -employeeService : EmployeeService
        -payrollService : PayrollService
        -currentUser : User
        +start(Stage)
        +showLogin()
        +showAdmin()
        +showEmployee()
    }
}

AppLauncher --> MainApp : calls
MainApp --> AuthService : uses
MainApp --> EmployeeService : uses
MainApp --> PayrollService : uses
MainApp --> User : holds

@enduml
